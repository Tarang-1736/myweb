<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nite Fuel | Sakura Night Station</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 3. Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- 4. Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Space Mono"', 'monospace'],
                        pixel: ['"VT323"', 'monospace'],
                    },
                    colors: {
                        lofi: {
                            bg: 'var(--bg-color)',
                            panel: 'var(--panel-color)',
                            border: 'var(--border-color)',
                            accent: 'var(--accent-color)',
                            highlight: 'var(--highlight-color)',
                            text: 'var(--text-color)',
                            muted: 'var(--muted-color)',
                            darkText: 'var(--dark-text)',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 1s ease-out forwards',
                        'float': 'float 6s ease-in-out infinite',
                        'scanline': 'scanline 8s linear infinite',
                        'marquee': 'marquee 25s linear infinite',
                        'pulse-glow': 'pulseGlow 2s infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        scanline: {
                            '0%': { transform: 'translateY(-100%)' },
                            '100%': { transform: 'translateY(100%)' },
                        },
                        marquee: {
                            '0%': { transform: 'translateX(100%)' },
                            '100%': { transform: 'translateX(-100%)' },
                        },
                        pulseGlow: {
                            '0%, 100%': { textShadow: '0 0 10px var(--highlight-color)' },
                            '50%': { textShadow: '0 0 20px var(--accent-color)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- 5. Styles -->
    <style>
        /* CSS Variables */
        :root {
            /* Default: SAKURA NIGHT (Solid Dark) */
            --bg-color: #120C16;      /* Deep Matte Plum */
            --bg-image: none;         /* No gradient for night */
            
            --panel-color: #1B1320;   /* Dark Mauve Card */
            --border-color: #442a3b;  /* Muted Wine Border */
            --accent-color: #8a4b6a;  /* Dark Raspberry */
            --highlight-color: #EBCAD8; /* Pale Sakura Pink */
            --text-color: #EBCAD8;      /* Pale Pink Text */
            --muted-color: #947C8C;   /* Muted Lavender */
            --dark-text: #3D212E;     /* Dark Text for "VIBE" */
            
            --overlay-opacity: 0.05;
            --shadow-color: rgba(0,0,0,0.5);
        }

        /* Cream Day Theme */
        [data-theme="day"] {
            --bg-color: #FFEFCB;      
            /* Explicit Gradient for Day Mode */
            --bg-image: linear-gradient(135deg, #FFFDE7 0%, #FFEFCB 50%, #FADCD5 100%);
            
            --panel-color: rgba(255, 253, 231, 0.95);   
            --border-color: #CFB284;  
            --accent-color: #DFCAA0;  
            --highlight-color: #5D4037; 
            --text-color: #5D4037;      
            --muted-color: #8D6E63;   
            --dark-text: #8D6E63;
            
            --overlay-opacity: 0.05;   
            --shadow-color: rgba(207, 178, 132, 0.4); 
        }

        /* Base Setup */
        body {
            background-color: #120C16; /* Hard fallback to dark */
            background-color: var(--bg-color);
            background-image: var(--bg-image);
            color: var(--text-color);
            font-family: 'Space Mono', monospace;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            transition: background-color 0.5s ease, color 0.3s ease;
            background-attachment: fixed;
            background-size: cover;
        }

        /* Overlays */
        .theme-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            opacity: var(--overlay-opacity);
            pointer-events: none; z-index: 0;
            mix-blend-mode: overlay;
        }
        .crt-lines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px;
            pointer-events: none; z-index: 1; opacity: 0.2;
        }

        /* Retro Card */
        .retro-card {
            background: var(--panel-color);
            opacity: 1;
            backdrop-filter: none;
            border: 2px solid var(--border-color);
            box-shadow: 0 0 0 1px rgba(0,0,0,0.2);
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        .retro-card:hover {
            border-color: var(--highlight-color);
            box-shadow: 0 0 15px var(--accent-color);
            transform: translateY(-2px);
        }

        /* Flashcard Flip Classes */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .flip-card-inner { transition: transform 0.6s; transform-style: preserve-3d; }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }

        /* Utility */
        .font-pixel { font-family: 'VT323', monospace; letter-spacing: 1px; }
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--bg-color); border-left: 1px solid var(--border-color); }
        ::-webkit-scrollbar-thumb { background: var(--accent-color); border: 1px solid var(--highlight-color); }
        ::-webkit-scrollbar-thumb:hover { background: var(--highlight-color); }
        .hidden-page { display: none; }
        input:focus, textarea:focus { outline: none; border-color: var(--highlight-color); box-shadow: 0 0 8px var(--border-color); background-color: var(--bg-color); color: var(--text-color); }
        .text-glow { text-shadow: 0 0 10px var(--accent-color); }
        
        .text-hollow-dark {
            color: var(--dark-text);
            font-weight: bold;
            text-shadow: 1px 1px 0px var(--border-color);
        }

        /* Chat Typing Animation */
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; display: inline-block; margin: 0 1px; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); opacity: 0.5; } 40% { transform: scale(1); opacity: 1; } }

        /* Calendar Input Styling */
        input[type="date"], input[type="number"] { color-scheme: light dark; }
    </style>
</head>

<body class="flex flex-col min-h-screen pb-10 transition-colors duration-500">

    <div class="theme-overlay"></div>
    <div class="crt-lines"></div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-40 bg-[var(--bg-color)]/95 border-b border-[var(--border-color)] backdrop-blur-md transition-colors duration-300" style="background-color: var(--bg-color); border-color: var(--border-color);">
        <div class="container mx-auto px-4 h-16 flex items-center justify-between">
            <a href="#" onclick="router('home')" class="flex items-center gap-3 group">
                <i class="fa-solid fa-moon text-lofi-highlight text-xl"></i>
                <span class="font-pixel text-3xl text-lofi-highlight tracking-widest group-hover:text-[var(--accent-color)] transition-colors">NITE FUEL</span>
            </a>

            <div class="flex items-center gap-6">
                <div class="hidden md:flex gap-4">
                    <button onclick="router('home')" class="nav-btn font-pixel text-xl text-lofi-muted hover:text-lofi-highlight transition-colors uppercase" data-target="home">[ Home ]</button>
                    <button onclick="router('dashboard')" class="nav-btn font-pixel text-xl text-lofi-muted hover:text-lofi-highlight transition-colors uppercase" data-target="dashboard">[ Station ]</button>
                    <button onclick="router('shop')" class="nav-btn font-pixel text-xl text-lofi-muted hover:text-lofi-highlight transition-colors uppercase" data-target="shop">[ Stash ]</button>
                    <button onclick="router('login')" class="nav-btn font-pixel text-xl text-lofi-muted hover:text-lofi-highlight transition-colors uppercase" data-target="login">[ Login ]</button>
                </div>
                
                
                <!-- Cart Toggle -->
                <button onclick="toggleCart()" class="text-lofi-highlight hover:text-lofi-accent transition-all transform hover:scale-110 relative group" title="Shopping Cart">
                    <i class="fa-solid fa-cart-shopping text-xl"></i>
                    <span id="cart-badge" class="absolute -top-2 -right-2 bg-lofi-accent text-lofi-bg text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center hidden">0</span>
                </button>

                <!-- THEME TOGGLE BULB -->
                <button onclick="toggleTheme()" class="text-lofi-highlight hover:text-lofi-accent transition-all transform hover:scale-110 relative group" title="Toggle Day/Night Theme">
                    <i class="fa-regular fa-lightbulb text-2xl" id="theme-icon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow pt-24 pb-12 px-4 relative z-10">
<a href="hero.html"></a>
        <!-- === HOME PAGE === -->
        <div id="home" class="container mx-auto max-w-6xl animate-fade-in">
            <div class="grid md:grid-cols-2 gap-12 items-start min-h-[70vh]">
                <!-- Left: Main Hero -->
                <div class="retro-card p-10 space-y-6 self-center">
                    <div class="inline-block px-3 py-1 border border-lofi-highlight/30 text-lofi-highlight font-pixel text-lg bg-lofi-highlight/5">
                        ðŸŒ¸ SYSTEM STATUS: ONLINE
                    </div>
                    <h1 class="font-pixel text-8xl leading-none text-lofi-highlight text-glow">
                        FOCUS <br> 
                        <span class="text-hollow-dark">VIBE</span> <br> 
                        SUCCEED
                    </h1>
                    <p class="text-lg text-lofi-highlight/90 leading-relaxed font-light max-w-md">
                        The ultimate study companion. Curated lofi beats, distraction-free tools, and energy snacks delivered to your door.
                    </p>
                    <div class="flex gap-4 pt-6 font-pixel text-2xl">
                        <button onclick="router('dashboard')" class="bg-lofi-highlight text-lofi-bg px-8 py-3 hover:bg-[var(--accent-color)] hover:text-white transition-colors font-bold tracking-wider">
                            ENTER STATION
                        </button>
                        <button onclick="router('shop')" class="border border-lofi-highlight text-lofi-highlight px-8 py-3 hover:bg-lofi-highlight/10 transition-colors">
                            GET FUEL
                        </button>
                    </div>
                </div>

                <!-- Right: Quick Tools -->
                <div class="space-y-6 self-center">
                    <div class="retro-card p-6 relative overflow-hidden">
                         <div class="absolute top-0 right-0 p-2">
                            <i class="fa-solid fa-lightbulb text-lofi-accent text-xl"></i>
                        </div>
                        <h3 class="font-pixel text-2xl text-lofi-muted mb-2">TIP OF THE DAY</h3>
                        <p id="daily-tip" class="text-lg text-lofi-highlight italic leading-relaxed">
                            "Loading wisdom..."
                        </p>
                    </div>

                    <div class="retro-card p-6">
                        <h3 class="font-pixel text-2xl text-lofi-muted mb-4">QUICK AMBIENCE</h3>
                        <div class="grid grid-cols-2 gap-4 font-pixel text-xl">
                            <button onclick="playAmbience('rain')" class="border border-lofi-highlight/50 hover:bg-lofi-highlight/20 hover:border-lofi-highlight text-lofi-highlight py-3 flex items-center justify-center gap-2 transition-all">
                                <i class="fa-solid fa-cloud-rain"></i> RAIN
                            </button>
                            <button onclick="playAmbience('cafe')" class="border border-lofi-highlight/50 hover:bg-lofi-highlight/20 hover:border-lofi-highlight text-lofi-highlight py-3 flex items-center justify-center gap-2 transition-all">
                                <i class="fa-solid fa-mug-hot"></i> CAFE
                            </button>
                        </div>
                    </div>
                </div> 
            </div>

            <!-- Features Section -->
            <div class="mt-20 grid md:grid-cols-3 gap-8">
                <div class="retro-card p-8 cursor-pointer group" onclick="router('shop')">
                    <div class="w-12 h-12 bg-lofi-highlight/10 rounded flex items-center justify-center mb-4 text-lofi-highlight text-2xl">
                        <i class="fa-solid fa-bolt"></i>
                    </div>
                    <h3 class="font-pixel text-3xl text-lofi-highlight mb-2">ENERGY & FOCUS</h3>
                    <p class="text-sm text-lofi-muted leading-relaxed">Curated snack kits with brain-boosting ingredients to keep you alert.</p>
                </div>
                <div class="retro-card p-8 cursor-pointer group" onclick="router('dashboard')">
                    <div class="w-12 h-12 bg-lofi-accent/10 rounded flex items-center justify-center mb-4 text-lofi-accent text-2xl">
                        <i class="fa-solid fa-clock"></i>
                    </div>
                    <h3 class="font-pixel text-3xl text-lofi-highlight mb-2">POMODORO TIMER</h3>
                    <p class="text-sm text-lofi-muted leading-relaxed">Built-in productivity timer with customizable intervals.</p>
                </div>
                <div class="retro-card p-8 cursor-pointer group" onclick="router('dashboard')">
                    <div class="w-12 h-12 bg-lofi-highlight/10 rounded flex items-center justify-center mb-4 text-lofi-highlight text-2xl">
                        <i class="fa-solid fa-music"></i>
                    </div>
                    <h3 class="font-pixel text-3xl text-lofi-highlight mb-2">LOFI BEATS</h3>
                    <p class="text-sm text-lofi-muted leading-relaxed">Integrated Spotify player with curated lofi playlists.</p>
                </div>
            </div>
        </div>

        <!-- === DASHBOARD PAGE === -->
        <div id="dashboard" class="container mx-auto max-w-7xl hidden-page animate-fade-in">
            <div class="mb-8 flex justify-between items-end">
                <div>
                    <h2 class="text-4xl font-pixel text-lofi-text mb-1" id="dashboard-title">COMMAND CENTER</h2>
                    <p class="text-lofi-muted text-sm font-bold">/// SESSION ACTIVE ///</p>
                </div>
                <div class="flex gap-4 items-center">
                    <button onclick="openGradeCalc()" class="font-pixel text-lg text-lofi-bg bg-lofi-highlight px-4 py-1 hover:bg-white transition-colors">
                        <i class="fa-solid fa-calculator mr-2"></i>GRADE CALC
                    </button>
                    <div id="clock" class="font-pixel text-3xl text-lofi-highlight bg-lofi-panel px-4 py-1 rounded border border-lofi-border">00:00:00</div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="space-y-6">
                    <!-- Timer -->
                    <div class="retro-card p-6 text-center relative overflow-hidden">
                        <div class="flex justify-between items-center mb-4 border-b border-lofi-border pb-2">
                            <h3 class="font-pixel text-2xl text-lofi-muted text-left">POMODORO TIMER</h3>
                            <button onclick="openSettingsModal()" class="text-lofi-highlight hover:text-white transition-colors"><i class="fa-solid fa-gear"></i></button>
                        </div>
                        <div id="timer-display" class="text-8xl font-pixel text-lofi-highlight tracking-widest my-4 text-glow">25:00</div>
                        <div id="timer-status" class="text-lofi-accent font-bold mb-6 tracking-widest text-sm">READY TO FOCUS</div>
                        <div class="grid grid-cols-3 gap-2 font-pixel text-xl mb-4">
                            <button id="btn-start" class="bg-lofi-border hover:bg-lofi-highlight hover:text-lofi-bg text-white py-2 transition-colors">START</button>
                            <button id="btn-pause" class="border border-lofi-border hover:border-lofi-highlight text-lofi-highlight py-2 transition-colors">PAUSE</button>
                            <button id="btn-reset" class="border border-lofi-border hover:bg-lofi-accent/20 text-lofi-muted py-2 transition-colors">RESET</button>
                        </div>
                        <div class="flex justify-center gap-3 border-t border-lofi-border pt-4 font-pixel text-sm text-lofi-muted">
                            <button onclick="setMode('focus')" class="hover:text-lofi-highlight transition-colors decoration-2 underline-offset-4 hover:underline">FOCUS</button>
                            <button onclick="setMode('short')" class="hover:text-lofi-highlight transition-colors decoration-2 underline-offset-4 hover:underline">SHORT</button>
                            <button onclick="setMode('long')" class="hover:text-lofi-highlight transition-colors decoration-2 underline-offset-4 hover:underline">LONG</button>
                        </div>
                    </div>
                    <!-- Music -->
                    <div class="retro-card p-4">
                        <div class="flex items-center justify-between mb-3 border-b border-lofi-border/50 pb-2"><span class="font-pixel text-xl text-lofi-highlight">LOFI WAVES</span><div class="flex gap-1"><div class="w-1.5 h-1.5 bg-lofi-highlight rounded-full animate-pulse"></div><div class="w-1.5 h-1.5 bg-lofi-accent rounded-full"></div></div></div>
                        <iframe id="spotify-frame" style="border-radius:4px; opacity: 0.9;" src="https://open.spotify.com/embed/playlist/0vvXsWCC9xrXsKd4FyS8kM?utm_source=generator&theme=0" width="100%" height="80" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
                    </div>
                </div>
                <!-- Tasks -->
                <div class="retro-card p-6 flex flex-col h-full min-h-[400px]">
                    <h3 class="font-pixel text-2xl text-lofi-muted mb-4 border-b border-lofi-border/50 pb-2">MISSION LOG</h3>
                    <div class="flex gap-2 mb-4"><input type="text" id="task-input" placeholder="> New Objective..." class="flex-1 bg-lofi-bg/50 border border-lofi-border px-3 py-2 text-lofi-highlight font-pixel text-xl placeholder-lofi-muted"><button onclick="addTask()" class="bg-lofi-accent text-lofi-bg px-4 font-bold hover:bg-white transition-colors">+</button></div>
                    <ul id="task-list" class="flex-1 overflow-y-auto space-y-2 pr-2 font-sans text-sm"></ul>
                </div>
                <!-- Notes/Countdown/Hydration/Flashcards -->
                <div class="space-y-6">
                    <!-- Flashcards -->
                    <div id="flashcard-widget" class="retro-card flip-card p-6 relative h-64 perspective-1000 group cursor-pointer" onclick="flipCard(this)">
                        <div class="absolute top-2 right-2 text-lofi-muted text-xs font-pixel">CLICK TO FLIP</div>
                        <div class="absolute top-2 left-2 flex gap-2 z-20" onclick="event.stopPropagation()">
                            <button onclick="openFlashcardModal('add')" class="text-xs border border-lofi-highlight text-lofi-highlight px-2 hover:bg-lofi-highlight hover:text-lofi-bg font-pixel" title="Add Card">+</button>
                            <button onclick="openFlashcardModal('edit')" class="text-xs text-lofi-muted hover:text-lofi-accent" title="Edit Current"><i class="fa-solid fa-pen"></i></button>
                            <button onclick="deleteCurrentCard()" class="text-xs text-lofi-muted hover:text-red-400" title="Delete"><i class="fa-solid fa-trash"></i></button>
                        </div>
                        <div class="flip-card-inner relative w-full h-full transform-style-3d transition-transform duration-500">
                            <div class="absolute w-full h-full backface-hidden bg-lofi-bg/50 border border-lofi-border flex flex-col items-center justify-center text-center p-6"><h3 class="font-pixel text-xl text-lofi-accent mb-2">QUESTION</h3><p id="fc-question" class="text-lofi-highlight text-lg">Loading...</p></div>
                            <div class="absolute w-full h-full backface-hidden bg-lofi-accent text-lofi-bg rotate-y-180 flex flex-col items-center justify-center text-center p-6"><h3 class="font-pixel text-xl mb-2">ANSWER</h3><p id="fc-answer" class="font-bold text-lg">...</p></div>
                        </div>
                        <div class="absolute bottom-2 left-0 w-full flex justify-center gap-8 z-20" onclick="event.stopPropagation()"><button onclick="prevCard()" class="text-lofi-muted hover:text-white font-pixel text-lg">&lt; PREV</button><span id="fc-counter" class="text-xs text-lofi-muted self-center">1/1</span><button onclick="nextCard()" class="text-lofi-muted hover:text-white font-pixel text-lg">NEXT &gt;</button></div>
                    </div>

                    <!-- Countdown -->
                    <div class="retro-card p-6"><div class="flex justify-between items-center mb-2 border-b border-lofi-border/50 pb-2"><h3 class="font-pixel text-2xl text-lofi-muted">DEADLINE TRACKER</h3><button onclick="openDeadlineModal()" class="text-lofi-highlight hover:text-white"><i class="fa-solid fa-gear"></i></button></div><div class="flex items-baseline gap-2"><span id="countdown-display" class="text-5xl font-pixel text-lofi-accent">--</span><span class="text-lofi-highlight font-pixel text-xl">DAYS</span></div><p id="exam-name" class="text-xs text-lofi-muted mt-1 tracking-widest">UNTIL EXAM DAY</p></div>
                    
                    <!-- Hydration -->
                    <div class="retro-card p-6"><div class="flex justify-between items-center mb-2 border-b border-lofi-border/50 pb-2"><h3 class="font-pixel text-2xl text-lofi-muted">HYDRATION LOG</h3><span id="water-count" class="font-pixel text-xl text-lofi-highlight">0/5</span></div><div class="flex justify-between items-center gap-2 mt-4"><button onclick="toggleWater(1)" class="water-drop text-3xl transition-all transform hover:scale-110 text-lofi-muted"><i class="fa-solid fa-glass-water"></i></button><button onclick="toggleWater(2)" class="water-drop text-3xl transition-all transform hover:scale-110 text-lofi-muted"><i class="fa-solid fa-glass-water"></i></button><button onclick="toggleWater(3)" class="water-drop text-3xl transition-all transform hover:scale-110 text-lofi-muted"><i class="fa-solid fa-glass-water"></i></button><button onclick="toggleWater(4)" class="water-drop text-3xl transition-all transform hover:scale-110 text-lofi-muted"><i class="fa-solid fa-glass-water"></i></button><button onclick="toggleWater(5)" class="water-drop text-3xl transition-all transform hover:scale-110 text-lofi-muted"><i class="fa-solid fa-glass-water"></i></button></div></div>
                    <div class="retro-card p-6 flex flex-col h-[200px]"><h3 class="font-pixel text-2xl text-lofi-muted mb-2">QUICK NOTES</h3><textarea id="scratchpad" class="flex-1 bg-lofi-bg/50 border border-lofi-border/50 rounded p-3 text-lofi-highlight font-sans text-sm resize-none focus:bg-lofi-bg" placeholder="> Capture thoughts..."></textarea></div>
                </div>
            </div>
        </div>

        <!-- ... (Shop, Login, Register pages same as before) ... -->
        <div id="shop" class="container mx-auto max-w-6xl hidden-page animate-fade-in">
            <div class="flex justify-center mb-10"><div class="retro-card p-6 text-center inline-block w-auto"><h2 class="text-6xl font-pixel text-lofi-highlight mb-2">SNACK ARMORY</h2><p class="text-lofi-muted font-pixel text-xl">/// BRAIN FOOD SUPPLIES ///</p></div></div>
            <div class="grid md:grid-cols-3 gap-8">
                 <!-- NEW BRAIN BOOSTER KIT -->
                 <div class="retro-card group p-4 hover:border-lofi-highlight transition-colors">
                     <div class="h-48 bg-lofi-bg mb-4 border border-lofi-border rounded relative overflow-hidden">
                         <img src="kits/Brain Booster.png" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity grayscale group-hover:grayscale-0">
                     </div>
                     <h3 class="font-pixel text-3xl text-lofi-text">BRAIN BOOSTER</h3>
                     <p class="text-xs text-lofi-muted mb-4 mt-2 h-10">Dark chocolate, nuts, berries & green tea.</p>
                     <div class="flex justify-between items-center border-t border-lofi-border pt-3">
                         <span class="font-pixel text-2xl text-lofi-accent">â‚¹139.00</span>
                         <button onclick="addToCart('BRAIN BOOSTER KIT', 139.00)" class="text-xs border border-lofi-highlight text-lofi-highlight px-3 py-1 hover:bg-lofi-highlight hover:text-lofi-bg transition-colors font-bold">ADD</button>
                     </div>
                 </div>

                 <div class="retro-card group p-4 hover:border-lofi-highlight transition-colors">
                     <div class="h-48 bg-lofi-bg mb-4 border border-lofi-border rounded relative overflow-hidden">
                         <img src="kits/Energy Burst.png" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity grayscale group-hover:grayscale-0">
                     </div>
                     <h3 class="font-pixel text-3xl text-lofi-text">ENERGY BURST</h3>
                     <p class="text-xs text-lofi-muted mb-4 mt-2 h-10">Granola bars, peanut butter, banana chips & dates.</p>
                     <div class="flex justify-between items-center border-t border-lofi-border pt-3">
                         <span class="font-pixel text-2xl text-lofi-accent">â‚¹109.00</span>
                         <button onclick="addToCart('ENERGY BURST KIT', 109.00)" class="text-xs border border-lofi-highlight text-lofi-highlight px-3 py-1 hover:bg-lofi-highlight hover:text-lofi-bg transition-colors font-bold">ADD</button>
                     </div>
                 </div>

                 <div class="retro-card group p-4 hover:border-lofi-highlight transition-colors">
                     <div class="h-48 bg-lofi-bg mb-4 border border-lofi-border rounded relative overflow-hidden">
                         <img src="kits/Calm & Focus.png" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity grayscale group-hover:grayscale-0">
                     </div>
                     <h3 class="font-pixel text-3xl text-lofi-text">CALM & FOCUS</h3>
                     <p class="text-xs text-lofi-muted mb-4 mt-2 h-10">Chamomile tea, makhana, roasted chana & jaggery</p>
                     <div class="flex justify-between items-center border-t border-lofi-border pt-3">
                         <span class="font-pixel text-2xl text-lofi-accent">â‚¹100.00</span>
                         <button onclick="addToCart('CALM & FOCUS KIT', 100.00)" class="text-xs border border-lofi-highlight text-lofi-highlight px-3 py-1 hover:bg-lofi-highlight hover:text-lofi-bg transition-colors font-bold">ADD</button>
                     </div>
                 </div>

                 <div class="retro-card group p-4 hover:border-lofi-highlight transition-colors">
                     <div class="h-48 bg-lofi-bg mb-4 border border-lofi-border rounded relative overflow-hidden">
                         <img src="kits/Quick Meal.png" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity grayscale group-hover:grayscale-0">
                     </div>
                     <h3 class="font-pixel text-3xl text-lofi-text">QUICK MEAL</h3>
                     <p class="text-xs text-lofi-muted mb-4 mt-2 h-10">Instant noodles, cup soup, ready-to-eat poha & oats.</p>
                     <div class="flex justify-between items-center border-t border-lofi-border pt-3">
                         <span class="font-pixel text-2xl text-lofi-accent">â‚¹109.00</span>
                         <button onclick="addToCart('QUICK MEAL KIT', 109.00)" class="text-xs border border-lofi-highlight text-lofi-highlight px-3 py-1 hover:bg-lofi-highlight hover:text-lofi-bg transition-colors font-bold">ADD</button>
                     </div>
                 </div>

                 <div class="retro-card group p-4 hover:border-lofi-highlight transition-colors">
                     <div class="h-48 bg-lofi-bg mb-4 border border-lofi-border rounded relative overflow-hidden">
                         <img src="kits/All Nighter Survival.png" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity grayscale group-hover:grayscale-0">
                     </div>
                     <h3 class="font-pixel text-3xl text-lofi-text">ALL-NIGHTER SURVIVAL</h3>
                     <p class="text-xs text-lofi-muted mb-4 mt-2 h-10">Instant coffee, protein cookies, dry fruits & an energy drink.</p>
                     <div class="flex justify-between items-center border-t border-lofi-border pt-3">
                         <span class="font-pixel text-2xl text-lofi-accent">â‚¹129.00</span>
                         <button onclick="addToCart('ALL-NIGHTER SURVIVAL KIT', 129.00)" class="text-xs border border-lofi-highlight text-lofi-highlight px-3 py-1 hover:bg-lofi-highlight hover:text-lofi-bg transition-colors font-bold">ADD</button>
                     </div>
                 </div>

                 <div class="retro-card group p-4 hover:border-lofi-highlight transition-colors">
                     <div class="h-48 bg-lofi-bg mb-4 border border-lofi-border rounded relative overflow-hidden">
                         <img src="kits/Hydration Refresh.png" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity grayscale group-hover:grayscale-0">
                     </div>
                     <h3 class="font-pixel text-3xl text-lofi-text">HYDRATION REFRESH</h3>
                     <p class="text-xs text-lofi-muted mb-4 mt-2 h-10">Coconut water, vitamin-C drink, mint gum & cucumber chips.</p>
                     <div class="flex justify-between items-center border-t border-lofi-border pt-3">
                         <span class="font-pixel text-2xl text-lofi-accent">â‚¹99.00</span>
                         <button onclick="addToCart('HYDRATION REFRESH KIT', 99.00)" class="text-xs border border-lofi-highlight text-lofi-highlight px-3 py-1 hover:bg-lofi-highlight hover:text-lofi-bg transition-colors font-bold">ADD</button>
                     </div>
                 </div>

                 <div class="retro-card group p-4 hover:border-lofi-highlight transition-colors">
                     <div class="h-48 bg-lofi-bg mb-4 border border-lofi-border rounded relative overflow-hidden">
                         <img src="kits/Healthy Mini-Meal.png" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity grayscale group-hover:grayscale-0">
                     </div>
                     <h3 class="font-pixel text-3xl text-lofi-text">HEALTHY MINI-MEAL</h3>
                     <p class="text-xs text-lofi-muted mb-4 mt-2 h-10">Hummus with crackers, trail mix, oat biscuits & smoothie mix.</p>
                     <div class="flex justify-between items-center border-t border-lofi-border pt-3">
                         <span class="font-pixel text-2xl text-lofi-accent">â‚¹119.00</span>
                         <button onclick="addToCart('HEALTHY MINI-MEAL KIT', 119.00)" class="text-xs border border-lofi-highlight text-lofi-highlight px-3 py-1 hover:bg-lofi-highlight hover:text-lofi-bg transition-colors font-bold">ADD</button>
                     </div>
                 </div>

                 <div class="retro-card group p-4 hover:border-lofi-highlight transition-colors">
                     <div class="h-48 bg-lofi-bg mb-4 border border-lofi-border rounded relative overflow-hidden">
                         <img src="kits/Sweet Break.png" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity grayscale group-hover:grayscale-0">
                     </div>
                     <h3 class="font-pixel text-3xl text-lofi-text">SWEET BREAK</h3>
                     <p class="text-xs text-lofi-muted mb-4 mt-2 h-10">Brownie bites, waffle rolls, peanuts & mini chocolates.</p>
                     <div class="flex justify-between items-center border-t border-lofi-border pt-3">
                         <span class="font-pixel text-2xl text-lofi-accent">â‚¹119.00</span>
                         <button onclick="addToCart('SWEET BREAK KIT', 119.00)" class="text-xs border border-lofi-highlight text-lofi-highlight px-3 py-1 hover:bg-lofi-highlight hover:text-lofi-bg transition-colors font-bold">ADD</button>
                     </div>
                 </div>

                 <div class="retro-card group p-4 hover:border-lofi-highlight transition-colors">
                     <div class="h-48 bg-lofi-bg mb-4 border border-lofi-border rounded relative overflow-hidden">
                         <img src="kits/Chill Study Kit.png" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity grayscale group-hover:grayscale-0">
                     </div>
                     <h3 class="font-pixel text-3xl text-lofi-text">CHILL STUDY</h3>
                     <p class="text-xs text-lofi-muted mb-4 mt-2 h-10">Cold coffee, nachos, salsa cup & popcorn.</p>
                     <div class="flex justify-between items-center border-t border-lofi-border pt-3">
                         <span class="font-pixel text-2xl text-lofi-accent">â‚¹112.00</span>
                         <button onclick="addToCart('CHILL STUDY KIT', 112.00)" class="text-xs border border-lofi-highlight text-lofi-highlight px-3 py-1 hover:bg-lofi-highlight hover:text-lofi-bg transition-colors font-bold">ADD</button>
                     </div>
                 </div>

                 <div class="retro-card group p-4 hover:border-lofi-highlight transition-colors">
                     <div class="h-48 bg-lofi-bg mb-4 border border-lofi-border rounded relative overflow-hidden">
                         <img src="kits/Productivity Power.png" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity grayscale group-hover:grayscale-0">
                     </div>
                     <h3 class="font-pixel text-3xl text-lofi-text">PRODUCTIVITY POWER</h3>
                     <p class="text-xs text-lofi-muted mb-4 mt-2 h-10">Protein shake, mixed seeds, rice cakes & vitamin gummies.</p>
                     <div class="flex justify-between items-center border-t border-lofi-border pt-3">
                         <span class="font-pixel text-2xl text-lofi-accent">â‚¹129.00</span>
                         <button onclick="addToCart('PRODUCTIVITY POWER KIT', 129.00)" class="text-xs border border-lofi-highlight text-lofi-highlight px-3 py-1 hover:bg-lofi-highlight hover:text-lofi-bg transition-colors font-bold">ADD</button>
                     </div>
                 </div>

                 <!-- Digital Loot -->
                 <div class="col-span-1 md:col-span-3 mt-8"><h3 class="font-pixel text-4xl text-lofi-highlight mb-6 text-center border-b border-lofi-border pb-2">DIGITAL LOOT</h3><div class="grid md:grid-cols-3 gap-6"><div class="retro-card p-4 flex items-center gap-4 cursor-pointer group" onclick="downloadLoot('wallpapers')"><div class="w-16 h-16 bg-blue-900/50 flex items-center justify-center border border-blue-500 text-blue-300"><i class="fa-solid fa-image text-2xl"></i></div><div><h4 class="font-pixel text-xl text-lofi-text group-hover:text-lofi-accent transition-colors">SAKURA WALLPAPERS</h4><p class="text-xs text-lofi-muted">4K Desktop & Mobile Pack</p><span class="text-lofi-accent text-sm font-bold">COMING SOON</span></div></div><div class="retro-card p-4 flex items-center gap-4 cursor-pointer group" onclick="downloadLoot('planner')"><div class="w-16 h-16 bg-purple-900/50 flex items-center justify-center border border-purple-500 text-purple-300"><i class="fa-solid fa-file-lines text-2xl"></i></div><div><h4 class="font-pixel text-xl text-lofi-text group-hover:text-lofi-accent transition-colors">STUDY PLANNER PDF</h4><p class="text-xs text-lofi-muted">Printable Weekly Schedule</p><span class="text-lofi-accent text-sm font-bold">COMING SOON</span></div></div><div class="retro-card p-4 flex items-center gap-4 cursor-pointer group" onclick="purchaseLoot('notion')"><div class="w-16 h-16 bg-green-900/50 flex items-center justify-center border border-green-500 text-green-300"><i class="fa-solid fa-table text-2xl"></i></div><div><h4 class="font-pixel text-xl text-lofi-text group-hover:text-lofi-accent transition-colors">NOTION TEMPLATE</h4><p class="text-xs text-lofi-muted">Student Life OS</p><span class="text-lofi-accent text-sm font-bold">COMING SOON</span></div></div></div></div>
            </div>
        </div>

        <div id="login" class="container mx-auto max-w-md hidden-page animate-fade-in pt-20"><div class="retro-card p-8 text-center relative overflow-hidden"><div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-lofi-border via-lofi-highlight to-lofi-border opacity-50"></div><h2 class="font-pixel text-4xl text-lofi-text mb-6 text-glow">IDENTITY VERIFICATION</h2><form onsubmit="handleLogin(event)" class="space-y-6 text-left"><div><label class="block text-lofi-muted text-xs mb-1 font-pixel">USER HANDLE</label><input type="text" id="login-user" placeholder="> Enter username..." class="w-full bg-lofi-bg/50 border border-lofi-border px-3 py-3 text-lofi-highlight font-pixel text-xl focus:outline-none focus:border-lofi-accent transition-colors"></div><div><label class="block text-lofi-muted text-xs mb-1 font-pixel">PASSCODE</label><input type="password" placeholder="> ************" class="w-full bg-lofi-bg/50 border border-lofi-border px-3 py-3 text-lofi-highlight font-pixel text-xl focus:outline-none focus:border-lofi-accent transition-colors"></div><button type="submit" class="w-full bg-lofi-highlight text-lofi-bg font-pixel text-2xl py-3 hover:bg-white transition-colors font-bold">JACK IN</button></form><p class="mt-6 text-lofi-muted text-xs font-sans">NEW USER? <a href="#" onclick="router('register')" class="text-lofi-accent hover:underline">INITIALIZE SEQUENCE</a></p></div></div>
        <div id="register" class="container mx-auto max-w-md hidden-page animate-fade-in pt-20"><div class="retro-card p-8 text-center relative overflow-hidden"><div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-lofi-accent via-lofi-highlight to-lofi-accent opacity-50"></div><h2 class="font-pixel text-4xl text-lofi-text mb-6 text-glow">SYSTEM REGISTRATION</h2><form onsubmit="handleRegister(event)" class="space-y-6 text-left"><div><label class="block text-lofi-muted text-xs mb-1 font-pixel">CREATE CODENAME</label><input type="text" id="reg-user" placeholder="> New username..." class="w-full bg-lofi-bg/50 border border-lofi-border px-3 py-3 text-lofi-highlight font-pixel text-xl focus:outline-none focus:border-lofi-accent transition-colors"></div><div><label class="block text-lofi-muted text-xs mb-1 font-pixel">SET PASSCODE</label><input type="password" placeholder="> ************" class="w-full bg-lofi-bg/50 border border-lofi-border px-3 py-3 text-lofi-highlight font-pixel text-xl focus:outline-none focus:border-lofi-accent transition-colors"></div><button type="submit" class="w-full bg-lofi-accent text-lofi-bg font-pixel text-2xl py-3 hover:bg-white transition-colors font-bold">ESTABLISH CONNECTION</button></form><p class="mt-6 text-lofi-muted text-xs font-sans">ALREADY INITIALIZED? <a href="#" onclick="router('login')" class="text-lofi-highlight hover:underline">JACK IN</a></p></div></div>
    </main>

    <div class="fixed bottom-0 left-0 w-full bg-lofi-panel border-t border-lofi-border z-50 overflow-hidden py-2">
        <div class="whitespace-nowrap animate-marquee text-lofi-highlight font-pixel text-lg tracking-widest">
            +++ STAY FOCUSED +++ YOU GOT THIS +++ DRINK WATER +++ JUST ONE MORE CHAPTER +++ NITE FUEL ONLINE +++ 
        </div>
    </div>

    <!-- Cart Modal (NEW) -->
    <div id="cart-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center hidden">
        <div class="retro-card p-8 w-full max-w-md animate-fade-in">
            <h3 class="font-pixel text-3xl text-lofi-highlight mb-4 text-center">YOUR STASH</h3>
            <div id="cart-items" class="space-y-3 max-h-60 overflow-y-auto mb-4 custom-scrollbar">
                <!-- Cart Items will be injected here -->
                <p class="text-lofi-muted text-center text-sm">Your cart is empty.</p>
            </div>
            <div class="border-t border-lofi-border pt-4 mb-4 flex justify-between font-pixel text-xl">
                <span class="text-lofi-muted">TOTAL:</span>
                <span id="cart-total" class="text-lofi-highlight">â‚¹0.00</span>
            </div>
            <div class="flex gap-2">
                <button onclick="checkout()" class="flex-1 bg-lofi-accent text-lofi-bg font-pixel text-xl py-2 hover:bg-white transition-colors">CHECKOUT</button>
                <button onclick="toggleCart()" class="flex-1 border border-lofi-muted text-lofi-muted font-pixel text-xl py-2 hover:text-white transition-colors">CLOSE</button>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div id="delete-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center hidden"><div class="retro-card p-8 w-full max-w-sm animate-fade-in text-center"><h3 class="font-pixel text-3xl text-lofi-highlight mb-4">CONFIRM DELETE</h3><p class="text-lofi-muted mb-6 font-sans text-sm">Are you sure you want to delete this flashcard?</p><div class="flex gap-2 justify-center"><button onclick="confirmDeleteCard()" class="bg-red-500 text-white font-pixel text-xl px-4 py-2 hover:bg-red-600 transition-colors">DELETE</button><button onclick="closeDeleteModal()" class="border border-lofi-muted text-lofi-muted font-pixel text-xl px-4 py-2 hover:text-white transition-colors">CANCEL</button></div></div></div>

    <!-- Other Modals (Grade, Timer, Deadline, Flashcard) -->
    <div id="grade-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center hidden"><div class="retro-card p-8 w-full max-w-sm animate-fade-in"><h3 class="font-pixel text-3xl text-lofi-highlight mb-4 text-center">GRADE CALCULATOR</h3><div class="space-y-4"><div><label class="block text-lofi-muted text-xs mb-1 font-pixel">CURRENT GRADE (%)</label><input type="number" id="current-grade" class="w-full bg-lofi-bg border border-lofi-border rounded p-2 text-lofi-highlight font-sans"></div><div><label class="block text-lofi-muted text-xs mb-1 font-pixel">TARGET GRADE (%)</label><input type="number" id="target-grade" class="w-full bg-lofi-bg border border-lofi-border rounded p-2 text-lofi-highlight font-sans"></div><div><label class="block text-lofi-muted text-xs mb-1 font-pixel">FINAL EXAM WEIGHT (%)</label><input type="number" id="final-weight" class="w-full bg-lofi-bg border border-lofi-border rounded p-2 text-lofi-highlight font-sans"></div><div id="grade-result" class="text-center font-pixel text-xl text-white hidden p-2 bg-lofi-bg/50 rounded border border-lofi-accent"></div><div class="flex gap-2 pt-2"><button onclick="calculateGrade()" class="flex-1 bg-lofi-accent text-lofi-bg font-pixel text-xl py-2 hover:bg-white">CALCULATE</button><button onclick="closeGradeCalc()" class="flex-1 border border-lofi-muted text-lofi-muted font-pixel text-xl py-2 hover:text-white">CLOSE</button></div></div></div></div>
    <div id="settings-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center hidden"><div class="retro-card p-8 w-full max-w-sm animate-fade-in"><h3 class="font-pixel text-3xl text-lofi-highlight mb-4 text-center">TIMER SETTINGS</h3><div class="space-y-4"><div><label class="block text-lofi-muted text-xs mb-1 font-pixel">FOCUS (MIN)</label><input type="number" id="focus-input" class="w-full bg-lofi-bg border border-lofi-border rounded p-2 text-lofi-highlight font-sans"></div><div><label class="block text-lofi-muted text-xs mb-1 font-pixel">SHORT (MIN)</label><input type="number" id="short-input" class="w-full bg-lofi-bg border border-lofi-border rounded p-2 text-lofi-highlight font-sans"></div><div><label class="block text-lofi-muted text-xs mb-1 font-pixel">LONG (MIN)</label><input type="number" id="long-input" class="w-full bg-lofi-bg border border-lofi-border rounded p-2 text-lofi-highlight font-sans"></div><div class="flex gap-2 pt-2"><button onclick="saveSettings()" class="flex-1 bg-lofi-accent text-lofi-bg font-pixel text-xl py-2 hover:bg-white">SAVE</button><button onclick="closeSettingsModal()" class="flex-1 border border-lofi-muted text-lofi-muted font-pixel text-xl py-2 hover:text-white">CANCEL</button></div></div></div></div>
    <div id="deadline-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center hidden"><div class="retro-card p-8 w-full max-w-sm animate-fade-in"><h3 class="font-pixel text-3xl text-lofi-highlight mb-4 text-center">SET TARGET DATE</h3><div class="space-y-4"><div><label class="block text-lofi-muted text-xs mb-1 font-pixel">SELECT DATE</label><input type="date" id="deadline-input" class="w-full bg-lofi-bg border border-lofi-border rounded p-2 text-lofi-highlight font-sans"></div><div class="flex gap-2 pt-2"><button onclick="saveDeadline()" class="flex-1 bg-lofi-accent text-lofi-bg font-pixel text-xl py-2 hover:bg-white">SAVE</button><button onclick="closeDeadlineModal()" class="flex-1 border border-lofi-muted text-lofi-muted font-pixel text-xl py-2 hover:text-white">CANCEL</button></div></div></div></div>
    <div id="fc-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center hidden"><div class="retro-card p-8 w-full max-w-sm animate-fade-in"><h3 class="font-pixel text-3xl text-lofi-highlight mb-4 text-center" id="fc-modal-title">NEW FLASHCARD</h3><div class="space-y-4"><div><label class="block text-lofi-muted text-xs mb-1 font-pixel">QUESTION</label><input type="text" id="fc-q-input" class="w-full bg-lofi-bg border border-lofi-border rounded p-2 text-lofi-highlight font-sans"></div><div><label class="block text-lofi-muted text-xs mb-1 font-pixel">ANSWER</label><input type="text" id="fc-a-input" class="w-full bg-lofi-bg border border-lofi-border rounded p-2 text-lofi-highlight font-sans"></div><div class="flex gap-2 pt-2"><button onclick="saveFlashcard()" class="flex-1 bg-lofi-accent text-lofi-bg font-pixel text-xl py-2 hover:bg-white">SAVE</button><button onclick="closeFlashcardModal()" class="flex-1 border border-lofi-muted text-lofi-muted font-pixel text-xl py-2 hover:text-white">CANCEL</button></div></div></div></div>

    <script>
        // --- THEME RESET TO NIGHT ---
        // Reset storage to force Night Mode on refresh
        if(!localStorage.getItem('nitefuel_theme')) {
            localStorage.setItem('nitefuel_theme', 'night');
        }
        // Remove any day theme attributes on load
        document.body.removeAttribute('data-theme');

        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const icon = document.getElementById('theme-icon');
            
            if (currentTheme === 'day') {
                // Switch to Night (Dark)
                body.removeAttribute('data-theme');
                icon.classList.remove('fa-solid');
                icon.classList.add('fa-regular');
                localStorage.setItem('nitefuel_theme', 'night');
            } else {
                // Switch to Day (Cream)
                body.setAttribute('data-theme', 'day');
                icon.classList.remove('fa-regular');
                icon.classList.add('fa-solid');
                localStorage.setItem('nitefuel_theme', 'day');
            }
        }
        
        // Check storage for toggle state (but default to night if not set)
        if(localStorage.getItem('nitefuel_theme') === 'day') {
            document.body.setAttribute('data-theme', 'day');
            document.getElementById('theme-icon').classList.remove('fa-regular');
            document.getElementById('theme-icon').classList.add('fa-solid');
        }

        // --- CART LOGIC ---
        let cart = JSON.parse(localStorage.getItem('nitefuel_cart')) || [];

        function toggleCart() {
            const modal = document.getElementById('cart-modal');
            if (modal.classList.contains('hidden')) {
                renderCart();
                modal.classList.remove('hidden');
            } else {
                modal.classList.add('hidden');
            }
        }

        function addToCart(title, price) {
            cart.push({ title, price });
            localStorage.setItem('nitefuel_cart', JSON.stringify(cart));
            updateCartBadge();
            alert(`ADDED: ${title}`);
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            localStorage.setItem('nitefuel_cart', JSON.stringify(cart));
            renderCart();
            updateCartBadge();
        }

        function renderCart() {
            const container = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            
            if (cart.length === 0) {
                container.innerHTML = '<p class="text-lofi-muted text-center text-sm font-sans">Your cart is empty.</p>';
                totalEl.innerText = "â‚¹0.00";
                return;
            }

            let html = '';
            let total = 0;

            cart.forEach((item, index) => {
                total += item.price;
                html += `
                    <div class="flex justify-between items-center border-b border-lofi-border/30 pb-2">
                        <div>
                            <h4 class="font-pixel text-lg text-lofi-text">${item.title}</h4>
                            <span class="text-xs text-lofi-muted">â‚¹${item.price.toFixed(2)}</span>
                        </div>
                        <button onclick="removeFromCart(${index})" class="text-red-400 hover:text-red-200 transition-colors"><i class="fa-solid fa-trash"></i></button>
                    </div>
                `;
            });

            container.innerHTML = html;
            totalEl.innerText = "â‚¹" + total.toFixed(2);
        }

        function updateCartBadge() {
            const badge = document.getElementById('cart-badge');
            badge.innerText = cart.length;
            if(cart.length > 0) badge.classList.remove('hidden');
            else badge.classList.add('hidden');
        }
        
        function checkout() {
            if(cart.length === 0) { alert("Cart is empty!"); return; }
            alert("PROCESSING PAYMENT... (Simulation)\n\nThank you for your purchase!");
            cart = [];
            localStorage.setItem('nitefuel_cart', JSON.stringify(cart));
            updateCartBadge();
            toggleCart();
        }

        // --- ROUTING ---
        function router(pageId) {
            ['home','dashboard','shop','login','register'].forEach(id=>document.getElementById(id).classList.add('hidden-page'));
            document.getElementById(pageId).classList.remove('hidden-page');
            document.getElementById(pageId).classList.add('animate-fade-in');
            updateUserDisplay();
        }
        
        function handleLogin(e) { e.preventDefault(); const user = document.getElementById('login-user').value; if(user) { localStorage.setItem('nitefuel_user', user); alert(`WELCOME BACK, ${user.toUpperCase()}`); router('dashboard'); } }
        function handleRegister(e) { e.preventDefault(); const user = document.getElementById('reg-user').value; if(user) { localStorage.setItem('nitefuel_user', user); alert(`SYSTEM INITIALIZED. WELCOME, ${user.toUpperCase()}`); router('dashboard'); } }
        function updateUserDisplay() { const user = localStorage.getItem('nitefuel_user'); const title = document.getElementById('dashboard-title'); if(user && title) title.textContent = `WELCOME, ${user.toUpperCase()}`; }

        // Flashcards
        let flashcards = JSON.parse(localStorage.getItem('nitefuel_fc')) || [{q:"What is Mitochondria?", a:"Powerhouse of the cell"}];
        let currentCard = 0;
        let editingCardIndex = -1;

        function updateCard() {
            const fcQ = document.getElementById('fc-question');
            const fcA = document.getElementById('fc-answer');
            const fcCount = document.getElementById('fc-counter');
            if (!fcQ || !fcA || !fcCount) return;
            
            if(flashcards.length === 0) {
                fcQ.innerText = "No cards";
                fcA.innerText = "Add one!";
                fcCount.innerText = "0/0";
                return; 
            }
            fcQ.innerText = flashcards[currentCard].q;
            fcA.innerText = flashcards[currentCard].a;
            fcCount.innerText = `${currentCard + 1}/${flashcards.length}`;
            const flipCard = document.getElementById('flashcard-widget');
            if(flipCard) flipCard.classList.remove('flipped');
        }

        function flipCard(el) { el.classList.toggle('flipped'); }
        function nextCard() { if(flashcards.length === 0) return; currentCard = (currentCard + 1) % flashcards.length; updateCard(); }
        function prevCard() { if(flashcards.length === 0) return; currentCard = (currentCard - 1 + flashcards.length) % flashcards.length; updateCard(); }

        function openFlashcardModal(mode) {
            document.getElementById('fc-modal').classList.remove('hidden');
            if(mode === 'edit' && flashcards.length > 0) {
                editingCardIndex = currentCard;
                document.getElementById('fc-modal-title').innerText = "EDIT FLASHCARD";
                document.getElementById('fc-q-input').value = flashcards[currentCard].q;
                document.getElementById('fc-a-input').value = flashcards[currentCard].a;
            } else {
                editingCardIndex = -1;
                document.getElementById('fc-modal-title').innerText = "NEW FLASHCARD";
                document.getElementById('fc-q-input').value = "";
                document.getElementById('fc-a-input').value = "";
            }
        }

        function closeFlashcardModal() { document.getElementById('fc-modal').classList.add('hidden'); }
        function saveFlashcard() {
            const q = document.getElementById('fc-q-input').value;
            const a = document.getElementById('fc-a-input').value;
            if(q && a) {
                if(editingCardIndex > -1) { flashcards[editingCardIndex] = {q, a}; } 
                else { flashcards.push({q, a}); currentCard = flashcards.length - 1; }
                localStorage.setItem('nitefuel_fc', JSON.stringify(flashcards));
                updateCard();
                closeFlashcardModal();
            }
        }
        
        // NEW DELETE MODAL LOGIC
        function deleteCurrentCard() {
            if(flashcards.length === 0) return;
            document.getElementById('delete-modal').classList.remove('hidden');
        }
        
        function closeDeleteModal() { document.getElementById('delete-modal').classList.add('hidden'); }
        function confirmDeleteCard() {
            flashcards.splice(currentCard, 1);
            localStorage.setItem('nitefuel_fc', JSON.stringify(flashcards));
            if(currentCard >= flashcards.length) currentCard = Math.max(0, flashcards.length - 1);
            updateCard();
            closeDeleteModal();
        }
        
        setTimeout(updateCard, 100);

        // --- STATS ---
        let stats = JSON.parse(localStorage.getItem('nitefuel_stats')) || {sessions: 0};
        if(document.getElementById('stats-count')){document.getElementById('stats-count').innerText=stats.sessions+" Sessions";document.getElementById('stats-bar').style.width=Math.min(stats.sessions*10,100)+"%";}

        // --- TIMER ---
        let timeLeft=25*60, timerId=null, isRunning=false, currentMode='FOCUS';
        let timerSettings={focus:25,short:5,long:15};
        const timerDisplay=document.getElementById('timer-display'), timerStatus=document.getElementById('timer-status'), btnStart=document.getElementById('btn-start');
        function updateTimerDisplay(){if(!timerDisplay)return;const m=Math.floor(timeLeft/60).toString().padStart(2,'0'),s=(timeLeft%60).toString().padStart(2,'0');timerDisplay.innerText=`${m}:${s}`;document.title=isRunning?`[${m}:${s}] Nite Fuel`:'Nite Fuel';}
        function setMode(mode){clearInterval(timerId);isRunning=false;if(mode==='focus'){currentMode='FOCUS';timeLeft=timerSettings.focus*60;if(timerStatus)timerStatus.textContent="READY TO FOCUS";}else if(mode==='short'){currentMode='SHORT';timeLeft=timerSettings.short*60;if(timerStatus)timerStatus.textContent="CHILL MODE";}else{currentMode='LONG';timeLeft=timerSettings.long*60;if(timerStatus)timerStatus.textContent="LONG REST";}if(btnStart)btnStart.textContent="START";updateTimerDisplay();}
        function startTimer(){if(isRunning)return;if("Notification"in window&&Notification.permission!=="granted")Notification.requestPermission();isRunning=true;if(timerStatus)timerStatus.textContent=`${currentMode} ACTIVE`;if(btnStart)btnStart.textContent="RUNNING";timerId=setInterval(()=>{if(timeLeft>0){timeLeft--;updateTimerDisplay();}else{completeTimer();}},1000);}
        function pauseTimer(){clearInterval(timerId);isRunning=false;if(timerStatus)timerStatus.textContent="PAUSED";if(btnStart)btnStart.textContent="RESUME";}
        function resetTimer(){clearInterval(timerId);isRunning=false;if(currentMode==='SHORT')setMode('short');else if(currentMode==='LONG')setMode('long');else setMode('focus');}
        function completeTimer(){clearInterval(timerId);isRunning=false;alert("Done!");stats.sessions++;localStorage.setItem('nitefuel_stats',JSON.stringify(stats));if(document.getElementById('stats-count'))document.getElementById('stats-count').innerText=stats.sessions+" Sessions";}
        
        function openSettingsModal(){document.getElementById('settings-modal').classList.remove('hidden');document.getElementById('focus-input').value=timerSettings.focus;document.getElementById('short-input').value=timerSettings.short;document.getElementById('long-input').value=timerSettings.long;}
        function closeSettingsModal(){document.getElementById('settings-modal').classList.add('hidden');}
        function saveSettings(){const f=parseInt(document.getElementById('focus-input').value)||25,s=parseInt(document.getElementById('short-input').value)||5,l=parseInt(document.getElementById('long-input').value)||15;timerSettings={focus:f,short:s,long:l};if(!isRunning)setMode('focus');closeSettingsModal();}
        
        if(btnStart){document.getElementById('btn-start').addEventListener('click',startTimer);document.getElementById('btn-pause').addEventListener('click',pauseTimer);document.getElementById('btn-reset').addEventListener('click',resetTimer);}
        
        // Hydration
        let water = parseInt(localStorage.getItem('nitefuel_water')) || 0;
        updateWaterUI();
        function toggleWater(n) {
            if (water === n) water = n - 1; else water = n;
            localStorage.setItem('nitefuel_water', water);
            updateWaterUI();
        }
        function updateWaterUI() {
            const wc = document.getElementById('water-count');
            if(wc) wc.innerText = water + "/5";
            document.querySelectorAll('.water-drop').forEach((el, i) => el.classList.toggle('text-blue-400', i < water));
        }

        // Tasks
        const taskList = document.getElementById('task-list');
        const taskInput = document.getElementById('task-input');
        let tasks = JSON.parse(localStorage.getItem('nitefuel_tasks')) || [];
        renderTasks();

        function addTask() {
            if(!taskInput) return;
            const t = taskInput.value.trim();
            if(!t) return;
            tasks.push({text: t, done: false});
            localStorage.setItem('nitefuel_tasks', JSON.stringify(tasks));
            renderTasks();
            taskInput.value = '';
        }

        function toggleTask(i) {
            tasks[i].done = !tasks[i].done;
            localStorage.setItem('nitefuel_tasks', JSON.stringify(tasks));
            renderTasks();
        }

        function deleteTask(i) {
            tasks.splice(i, 1);
            localStorage.setItem('nitefuel_tasks', JSON.stringify(tasks));
            renderTasks();
        }

        function renderTasks() {
            if(!taskList) return;
            taskList.innerHTML = '';
            tasks.forEach((t, i) => {
                const li = document.createElement('li');
                li.className = `flex justify-between items-center p-2 border-b border-lofi-border/30 hover:bg-white/5 transition-colors group ${t.done ? 'opacity-50' : ''}`;
                li.innerHTML = `<div class="flex items-center gap-3 cursor-pointer" onclick="toggleTask(${i})"><div class="w-4 h-4 border border-lofi-highlight flex items-center justify-center">${t.done?'<div class="w-2 h-2 bg-lofi-highlight"></div>':''}</div><span class="${t.done?'line-through text-lofi-muted':'text-lofi-highlight'}">${t.text}</span></div><button onclick="deleteTask(${i})" class="text-xs text-red-400 opacity-0 group-hover:opacity-100">[x]</button>`;
                taskList.appendChild(li);
            });
        }
        if(taskInput) taskInput.addEventListener('keypress', (e) => e.key === 'Enter' && addTask());

        // Misc
        const scratchpad = document.getElementById('scratchpad');
        if(scratchpad) {
            scratchpad.value = localStorage.getItem('nitefuel_notes') || '';
            scratchpad.addEventListener('input', () => localStorage.setItem('nitefuel_notes', scratchpad.value));
        }
        
        function openDeadlineModal() { const d = localStorage.getItem('nitefuel_exam_date'); if(d) document.getElementById('deadline-input').value = d; document.getElementById('deadline-modal').classList.remove('hidden'); }
        function closeDeadlineModal() { document.getElementById('deadline-modal').classList.add('hidden'); }
        function saveDeadline() { const d = document.getElementById('deadline-input').value; if(d) { localStorage.setItem('nitefuel_exam_date', d); updateCountdown(); closeDeadlineModal(); } }
        function updateCountdown() {
            const d = localStorage.getItem('nitefuel_exam_date');
            const disp = document.getElementById('countdown-display');
            const st = document.getElementById('exam-name');
            if(!disp) return;
            if(!d) { disp.textContent = "--"; return; }
            const t = new Date(d); t.setHours(0,0,0,0);
            const n = new Date(); n.setHours(0,0,0,0);
            const diff = t - n;
            const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
            if (days > 0) {
                disp.textContent = days.toString().padStart(2, '0');
                if(days <= 3) { st.textContent = "âš ï¸ CRUNCH TIME"; st.classList.add('text-red-400','animate-pulse'); } 
                else { st.textContent = "UNTIL EXAM DAY"; st.classList.remove('text-red-400','animate-pulse'); }
            } else if (days === 0) { disp.textContent = "00"; st.textContent = "TODAY IS THE DAY"; } 
            else { disp.textContent = "00"; st.textContent = "COMPLETED"; }
        }

        function openGradeCalc() { document.getElementById('grade-modal').classList.remove('hidden'); }
        function closeGradeCalc() { document.getElementById('grade-modal').classList.add('hidden'); document.getElementById('grade-result').classList.add('hidden'); }
        function calculateGrade() {
            const c = parseFloat(document.getElementById('current-grade').value);
            const t = parseFloat(document.getElementById('target-grade').value);
            const w = parseFloat(document.getElementById('final-weight').value);
            if (isNaN(c) || isNaN(t) || isNaN(w)) { alert("Please fill all fields"); return; }
            const wd = w / 100;
            const req = (t - ((1 - wd) * c)) / wd;
            const r = document.getElementById('grade-result');
            r.classList.remove('hidden');
            r.innerHTML = `YOU NEED: <span class="text-lofi-accent">${req.toFixed(1)}%</span><br><span class="text-xs text-lofi-muted">ON THE FINAL</span>`;
        }

        function playAmbience(type) {
            const f = document.getElementById('spotify-frame');
            if (document.getElementById('dashboard').classList.contains('hidden-page')) router('dashboard');
            if (type === 'rain') f.src = "https://open.spotify.com/embed/playlist/37i9dQZF1DXbvABJXBIyiY?utm_source=generator&theme=0";
            else if (type === 'cafe') f.src = "https://open.spotify.com/embed/playlist/7K6fVGUcL6ChCsRMJP4oOC?utm_source=generator&theme=0";
        }
        
        function downloadLoot(t) {
            let f = "", c = "DUMMY CONTENT";
            if (t === 'wallpapers') f = "Sakura_Wallpapers_4K.zip";
            else if (t === 'planner') f = "Study_Planner_v1.pdf";
            const e = document.createElement('a');
            e.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(c));
            e.setAttribute('download', f);
            e.style.display = 'none';
            document.body.appendChild(e);
            e.click();
            document.body.removeChild(e);
            alert(`DOWNLOAD STARTED: ${f}\n\n(Demo download)`);
        }
        
        function purchaseLoot(i) { alert("ADDING TO CART...\n\nItem: Notion Student OS\nPrice: $5.00\n\n(Payment Gateway Simulation)"); }
        
        setInterval(()=>{if(document.getElementById('clock'))document.getElementById('clock').innerText=new Date().toLocaleTimeString()},1000);
        updateCountdown(); updateTimerDisplay();
        updateCartBadge(); // Init Badge

        // Load Random Tip
        const tips = ["Tip: 5 minute breaks improve recall.", "Tip: Drink water every 30 mins.", "Tip: Teach it to learn it better.", "Tip: Sleep solidifies memory.", "Tip: Do hard tasks first."];
        function loadRandomTip() { const tipEl=document.getElementById('daily-tip'); if(tipEl) tipEl.textContent=tips[Math.floor(Math.random()*tips.length)]; }
        loadRandomTip();
    </script>
</body>
</html>